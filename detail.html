<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>商品詳細</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-white">

<div id="app" class="p-4"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbytlAF3m4a7aBWOQr1ZRRfaXf2LZyrVRJdq1fG9ABve4avlkVZixVyJadCUyyx5WO9O/exec";
const code = new URLSearchParams(location.search).get("code");

fetch(API_URL)
  .then(res => res.json())
  .then(data => {
    const p = data.products.find(x => x.code === code);
    renderDetail(p);
  });

let currentProduct;
let selectedColor = 0;
let selectedSize = "";

function renderDetail(p) {
  currentProduct = p;

  document.getElementById("app").innerHTML = `
    <img id="mainImg" src="${p.carousel[0][0]}" class="w-full rounded">

    <div class="flex gap-2 mt-3">
      ${p.color.swatches.map((c, i) => `
        <button class="w-6 h-6 rounded-full border"
          style="background:${c.startsWith('#') ? c : `url(${c})`}"
          onclick="changeColor(${i})">
        </button>
      `).join('')}
    </div>

    <p id="colorText" class="text-sm mt-2">${p.color.names[0]}</p>

    <h1 class="mt-3 font-bold">${p.name}</h1>

    <div class="mt-4">
      ${p.sizes.baby?.options.map(s => `
        <button class="border px-3 py-1 mr-1 text-sm"
          onclick="selectSize('${s}')">${s}</button>
      `).join('')}
    </div>

    <button class="mt-6 w-full bg-black text-white py-2 rounded"
      onclick="addToCart()">
      加入購物車
    </button>
  `;
}

function changeColor(i) {
  selectedColor = i;
  document.getElementById("mainImg").src = currentProduct.carousel[i][0];
  document.getElementById("colorText").innerText = currentProduct.color.names[i];
}

function selectSize(size) {
  selectedSize = size;
  alert("已選尺寸：" + size);
}

function addToCart() {
  if (!selectedSize) {
    alert("請先選擇尺寸");
    return;
  }

  const cart = JSON.parse(localStorage.getItem("cart") || "[]");
  cart.push({
    code: currentProduct.code,
    name: currentProduct.name,
    color: currentProduct.color.names[selectedColor],
    size: selectedSize,
    qty: 1
  });
  localStorage.setItem("cart", JSON.stringify(cart));
  alert("已加入購物車");
}
</script>

</body>
</html>
