<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>AiFang Kids</title>
  <link rel="stylesheet" href="./index.css">
</head>
<body>

<div id="product-list"></div>

<script src="./js/api.js"></script>
<script>
/* ========= 價格顯示規則 ========= */
function getDisplayPrice(item) {
  const prices = [
    item.price_baby_sale || item.price_baby,
    item.price_kid_sale || item.price_kid,
    item.price_junior_sale || item.price_junior,
    item.price_adult_sale || item.price_adult
  ].filter(v => Number(v) > 0);

  return prices.length ? Math.min(...prices) : "";
}

/* ========= render ========= */
function render(items) {
  const el = document.getElementById("product-list");
  el.innerHTML = "";

  items.forEach(item => {
    const price = getDisplayPrice(item);

    const card = document.createElement("div");
    card.className = "product-card";

    card.innerHTML = `
      <div class="img-wrap"
        style="background-image:url('${item.image_main || ""}')"
        onmouseenter="this.style.backgroundImage='url(${item.image_hover || item.image_main || ""})'"
        onmouseleave="this.style.backgroundImage='url(${item.image_main || ""})'">
        ${item.is_new ? `<span class="badge-new">NEW</span>` : ""}
      </div>

      <div class="info-wrap">
        <p class="p-name">${item.name || ""}</p>
        ${price ? `<p class="p-price">NT$ ${price}</p>` : ""}
      </div>
    `;

    el.appendChild(card);
  });
}

/* ========= init ========= */
(async function init(){
  try {
    const items = await fetchProducts();
    render(items);
  } catch (e) {
    console.error("商品載入失敗", e);
  }
})();
</script>

</body>
</html>
